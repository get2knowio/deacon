# Features Test Diagrams

## Sequence: Autogenerated Test (test.sh)
```mermaid
sequenceDiagram
    autonumber
    participant U as User
    participant CLI as devcontainer CLI
    participant R as Runtime (Docker)
    participant W as Workspace (temp)
    U->>CLI: features test -f <id>
    CLI->>CLI: validate flags and layout
    CLI->>W: copy test/<id>/ into temp workspace
    CLI->>W: write dev-container-features-test-lib
    CLI->>R: launch container from base image
    R-->>CLI: container ID
    CLI->>R: exec /bin/bash test.sh
    R-->>CLI: exit code
    CLI-->>U: summarize results, set process exit code
```

## Sequence: Scenario Test
```mermaid
sequenceDiagram
    autonumber
    participant CLI as devcontainer CLI
    participant R as Runtime (Docker)
    participant J as scenarios.json
    participant W as Workspace (temp)
    CLI->>J: parse scenario definitions
    J-->>CLI: {scenarioName: DevContainerConfig}
    loop per scenario
      CLI->>W: generate project from scenario
      CLI->>R: create container from workspace
      CLI->>R: exec scenario.sh
      R-->>CLI: exit code
      CLI->>CLI: append result
    end
    CLI-->>CLI: cleanup unless preserve=true
```

## Data Flow: Results Aggregation
```mermaid
flowchart TD
  A[Run Tests] --> B[Collect { testName, result }]
  B --> C{All Passed?}
  C -- yes --> D[Exit 0]
  C -- no --> E[Exit 1]
```

