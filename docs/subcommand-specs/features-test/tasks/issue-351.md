# [Infrastructure] Test library, temp workspace, and container labeling/cleanup for features-test

<!-- Labels: infrastructure, cross-cutting, subcommand:features-test, priority:high -->
Tracks: #345

## Issue Type
- [x] Infrastructure/Cross-Cutting Concern
- [x] Core Logic Implementation

## Description
Implement the reusable testing infrastructure:
- Generate and write `dev-container-features-test-lib` into a temp workspace
- Copy test files into ephemeral directories per test/scenario
- Launch containers with label `devcontainer.is_test_run=true`
- Cleanup containers by label unless `--preserve-test-containers`

## Specification Reference
- SPEC.md ยง5 Core Execution Logic; ยง7 External System Interactions
- DIAGRAMS.md: Autogenerated Test and Scenario sequences
- GAP.md ยง3 Test Execution Gaps; ยง3.2 Container Lifecycle

## Implementation Requirements

### Code Changes Required
- New module in `crates/core/src/features/test_runner.rs` (or similar) for reusable helpers
- Wire from `crates/deacon/src/commands/features.rs`

### Specific Tasks
- [ ] Write helper file content (assertion functions) with minimal API
- [ ] Create temp workspace per run; copy `test/<id>/` contents
- [ ] Launch containers with label and base image/remote user parameters
- [ ] Implement cleanup routine that removes labeled containers

## Testing Requirements
- Unit: library file creation, path handling
- Integration: container labeled; cleanup works; preserve flag prevents

## Acceptance Criteria
- Infrastructure reusable for autogenerated and scenarios
- CI green

## References
- PARITY_APPROACH.md Theme 1 (JSON Output), Theme 2 (Validation), Theme 6 (Error messages)

Issue: https://github.com/get2knowio/deacon/issues/351
