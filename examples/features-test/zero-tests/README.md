# Zero Tests Example

## What This Demonstrates

This example shows the behavior when test selection results in zero tests being executed, which can occur when:

- Using `--filter` with no matching scenarios
- Using `--features` with non-existent feature IDs
- Skipping all test types
- Empty collection (no features in `src/`)

## Key Behavior

When zero tests are discovered/selected:
- **Exit code**: 0 (not an error)
- **Text output**: "No tests found (after selection/filter)"
- **JSON output**: Exactly `[]`
- **No failures**: Zero tests ≠ test failure

## Scenarios That Produce Zero Tests

### 1. Non-matching Filter
```sh
# No scenarios named "nonexistent"
deacon features test . --filter nonexistent
```

### 2. Non-existent Feature
```sh
# No feature called "missing-feature"
deacon features test . --features missing-feature
```

### 3. Skip All Test Types
```sh
# Nothing left to run
deacon features test . --skip-autogenerated --skip-scenarios --skip-duplicated
```

### 4. Global-only with No Globals
```sh
# No _global directory exists
deacon features test . --global-scenarios-only
```

## Expected Output

### Text Mode
```text
No tests found (after selection/filter).
```

### JSON Mode
```json
[]
```

### Exit Code
```sh
deacon features test . --filter nonexistent
echo $?  # Prints: 0
```

## Collection Structure

```
zero-tests/
├── src/
│   └── simple-feature/
└── test/
    └── simple-feature/
        ├── test.sh
        └── scenarios.jsonc  # Contains: "scenario-a", "scenario-b"
```

## Commands

```sh
# Filter with no matches
deacon features test . --filter xyz

# Select non-existent feature
deacon features test . --features nonexistent

# JSON output with zero tests
deacon features test . --filter xyz --json

# Skip everything
deacon features test . --skip-autogenerated --skip-scenarios --skip-duplicated
```

## Example Runs

### Filter No Match (Text)
```text
$ deacon features test . --filter xyz
No tests found (after selection/filter).

$ echo $?
0
```

### Filter No Match (JSON)
```text
$ deacon features test . --filter xyz --json
[]

$ echo $?
0
```

## Why Exit Code is 0

Zero tests is **not an error condition** because:
- Intentional filtering may result in zero tests (valid use case)
- Empty collections during initialization are normal
- CI pipelines shouldn't fail on expected empty results
- Allows conditional testing workflows

## Use Cases

### CI Conditional Testing
```yaml
# Only test changed features
- name: Get changed features
  id: changes
  run: echo "features=$(git diff --name-only | grep src/ | cut -d/ -f2)" >> $GITHUB_OUTPUT

- name: Test changed features
  run: |
    if [ -n "${{ steps.changes.outputs.features }}" ]; then
      deacon features test . --features ${{ steps.changes.outputs.features }}
    else
      echo "No features changed, skipping tests"
      # Exits 0 even with zero tests
    fi
```

### Development Workflow
```sh
# Working on a feature that doesn't exist yet
deacon features test . --features my-new-feature
# Returns: No tests found
# Exit 0 - doesn't block your workflow
```

## Distinguishing Zero Tests from Failures

```sh
# Zero tests: Exit 0
deacon features test . --filter nonexistent
echo $?  # 0

# Test failures: Exit non-zero
deacon features test . --features failing-feature
echo $?  # Non-zero
```

## JSON Parsing

```python
import json
import sys

with open('results.json') as f:
    results = json.load(f)
    
if len(results) == 0:
    print("No tests were run")
    sys.exit(0)  # Not a failure
    
failed = [t for t in results if not t['result']]
if failed:
    print(f"Failed: {len(failed)}")
    sys.exit(1)  # This is a failure
```

## Related Examples

- `scenario-filtering/` - Shows filter behavior with matches
- `feature-selection/` - Shows feature selection with valid features
- `json-output/` - JSON format with actual test results
