# Scenario Filtering Example

## What This Demonstrates

This example shows how to use the `--filter` flag to run only scenarios whose names match a specific substring. This is useful for:

- **Quick validation**: Test specific scenarios without running the full suite
- **Platform-specific testing**: Run only scenarios for a particular OS or environment
- **Debugging**: Isolate failing scenarios for investigation
- **Subset testing**: Test related scenarios together (e.g., all "minimal" or "full" scenarios)

## Key Behavior

The `--filter` flag:
- Performs **case-sensitive substring matching** on scenario names
- Applies to both feature-specific and global scenarios
- Does **not** filter feature IDs or file names, only scenario names
- Can be combined with `--features` to filter scenarios within selected features
- Cannot be used with `--skip-scenarios` (mutually exclusive)

## Collection Structure

```
scenario-filtering/
├── src/
│   └── database-tools/
└── test/
    └── database-tools/
        ├── test.sh
        └── scenarios.jsonc  # Multiple scenarios with descriptive names
```

## Scenario Names in This Example

- `minimal-postgres` - Lightweight PostgreSQL setup
- `minimal-mysql` - Lightweight MySQL setup
- `full-postgres` - Complete PostgreSQL with extensions
- `full-mysql` - Complete MySQL with tools
- `benchmark-postgres` - Performance testing scenario
- `benchmark-mysql` - Performance testing scenario

## Commands

```sh
# Run only scenarios with "minimal" in the name
deacon features test . --filter minimal

# Run only PostgreSQL scenarios
deacon features test . --filter postgres

# Run only benchmark scenarios
deacon features test . --filter benchmark

# Combine with feature selection
deacon features test . --features database-tools --filter full
```

## Expected Output (--filter minimal)

```text
Running features test suite...

Scenario Tests:
  ✓ database-tools: minimal-postgres
  ✓ database-tools: minimal-mysql

Summary: 2 tests, 2 passed, 0 failed

Note: Autogenerated and duplicate tests still run (use --skip-* to exclude them)
Note: Filter matched 2 of 6 scenarios
```

## Filter Matching Examples

### Filter: "minimal"
- ✓ Matches: `minimal-postgres`, `minimal-mysql`
- ✗ No match: `full-postgres`, `benchmark-postgres`

### Filter: "postgres"  
- ✓ Matches: `minimal-postgres`, `full-postgres`, `benchmark-postgres`
- ✗ No match: `minimal-mysql`, `full-mysql`, `benchmark-mysql`

### Filter: "benchmark"
- ✓ Matches: `benchmark-postgres`, `benchmark-mysql`
- ✗ No match: All other scenarios

### Filter: "MINIMAL" (case-sensitive)
- ✗ No matches (filter is case-sensitive, scenarios use lowercase)

## Use Cases

### CI Matrix Testing
```yaml
# .github/workflows/test-databases.yml
strategy:
  matrix:
    database: [postgres, mysql]
steps:
  - run: deacon features test . --filter ${{ matrix.database }}
```

### Local Development Workflow
```sh
# Quick smoke test with minimal scenarios
deacon features test . --filter minimal

# Test all PostgreSQL scenarios after making changes
deacon features test . --filter postgres

# Run benchmarks before release
deacon features test . --filter benchmark
```

### Debugging Specific Failures
```sh
# A "full-mysql" scenario failed in CI, reproduce locally
deacon features test . --filter full-mysql --preserve-test-containers
```

## Important Notes

1. **Autogenerated tests always run** unless `--skip-autogenerated` is set
2. **Duplicate tests always run** unless `--skip-duplicated` is set
3. Filter applies only to scenario names, not to these test types
4. **Case-sensitive**: "Minimal" won't match "minimal"
5. **Substring match**: "sql" matches "mysql" and "postgres" scenarios

## DevContainer Specification References

- **[Feature Testing](https://containers.dev/implementors/spec/#testing-features)**: Testing approaches
- **[Test Scenarios](https://containers.dev/implementors/features/)**: Community testing patterns

## Related Examples

- `basic-test-suite/` - See all test types without filtering
- `feature-selection/` - Select specific features
- `skip-test-types/` - Skip autogenerated or duplicate tests
