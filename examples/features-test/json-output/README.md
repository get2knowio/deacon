# JSON Output Example

## What This Demonstrates

This example shows the `--json` flag which outputs test results as a strict JSON array to stdout, making it easy to parse and integrate with CI/CD tools.

## Key Behavior

With `--json`:
- **stdout**: Exactly `[{"testName": string, "result": boolean}, ...]`
- **stderr**: All logs, progress, and diagnostic messages
- **No envelope**: Just the array, no wrapper objects
- **Not NDJSON**: Single JSON array, not newline-delimited
- **No extra fields**: Only `testName` and `result` (boolean)

## JSON Schema

```json
[
  {
    "testName": "feature-id",
    "result": true
  },
  {
    "testName": "feature-id (duplicate/idempotence)",
    "result": true
  },
  {
    "testName": "feature-id: scenario-name",
    "result": false
  }
]
```

## Commands

```sh
# Basic JSON output
deacon features test . --json

# Combine with other flags
deacon features test . --json --features my-feature

# Save JSON to file
deacon features test . --json > results.json 2> test.log

# Parse with jq
deacon features test . --json | jq '.[] | select(.result == false)'
```

## Example Output

### Stdout (JSON only)
```json
[
  {"testName": "cli-tools", "result": true},
  {"testName": "cli-tools (duplicate/idempotence)", "result": true},
  {"testName": "cli-tools: ubuntu", "result": true},
  {"testName": "cli-tools: alpine", "result": true}
]
```

### Stderr (logs)
```text
2025-01-01T12:00:00Z INFO Starting test suite
2025-01-01T12:00:01Z INFO Running autogenerated test: cli-tools
2025-01-01T12:00:05Z INFO Running duplicate test: cli-tools
...
```

## Use Cases

### CI Integration
```yaml
# GitHub Actions
- name: Run feature tests
  id: test
  run: |
    deacon features test . --json > results.json
    
- name: Process results
  run: |
    FAILED=$(jq '[.[] | select(.result == false)] | length' results.json)
    echo "Failed tests: $FAILED"
    test "$FAILED" -eq 0
```

### Test Result Processing
```sh
# Count pass/fail
jq '[group_by(.result)[] | {result: .[0].result, count: length}]' results.json

# List all failures
jq -r '.[] | select(.result == false) | .testName' results.json

# Generate report
jq -r '.[] | "\(.testName): \(if .result then "PASS" else "FAIL" end)"' results.json
```

### Automated Analysis
```python
import json

with open('results.json') as f:
    results = json.load(f)
    
failed = [t for t in results if not t['result']]
if failed:
    print(f"Failed tests: {', '.join(t['testName'] for t in failed)}")
    exit(1)
```

## Zero Tests Output

When no tests are discovered (due to filters or empty collection):

**Stdout:**
```json
[]
```

**Exit code:** 0

## Collection Structure

```
json-output/
├── src/
│   └── cli-tools/
└── test/
    └── cli-tools/
```

## Related Examples

- `basic-test-suite/` - See text output format
- `zero-tests/` - JSON output when no tests run
